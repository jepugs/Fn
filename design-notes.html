<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-05-30 Sun 23:21 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orga946ed3">1. Prelude</a></li>
<li><a href="#org3f70818">2. Language Design Decisions</a>
<ul>
<li><a href="#org540550c">2.1. <code>let</code> as an inline operation</a></li>
<li><a href="#orgab13a1a">2.2. Parameter/Argument Dichotomy</a></li>
<li><a href="#org7da64c6">2.3. Argument Lists/Keyword Syntax</a></li>
<li><a href="#org5fdb943">2.4. Legal variables names and immutability of globals</a></li>
<li><a href="#orge8a2771">2.5. Parameters have default values instead of initforms</a></li>
<li><a href="#orgc039555">2.6. Arguments to <code>apply</code></a></li>
<li><a href="#orgf092468">2.7. Namespace Search Paths</a></li>
<li><a href="#org5c58bef">2.8. Table Calls</a></li>
</ul>
</li>
<li><a href="#org31d20c1">3. Implementation Decisions</a>
<ul>
<li><a href="#orgdbebb8d">3.1. Why add a <code>vm_handle</code> type?</a></li>
<li><a href="#org9e6a1d3">3.2. Why value is a union and only some things are methods</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orga946ed3" class="outline-2">
<h2 id="orga946ed3"><span class="section-number-2">1</span> Prelude</h2>
<div class="outline-text-2" id="text-1">
<p>
This file documents rationale for various design decisions made in the
specification and implementation of Fn, as well as information about idioms and
conventions for Fn. Only the rationale is given here, so you may need to refer
back to the source code or spec to see what I'm talking about.
</p>

<p>
At some point, this informal pile of information will have to be reorganized
into a more digestible form.
</p>
</div>
</div>


<div id="outline-container-org3f70818" class="outline-2">
<h2 id="org3f70818"><span class="section-number-2">2</span> Language Design Decisions</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org540550c" class="outline-3">
<h3 id="org540550c"><span class="section-number-3">2.1</span> <code>let</code> as an inline operation</h3>
<div class="outline-text-3" id="text-2-1">
<p>
LISP needed a way to introduce new local bindings partway through a computation
without increasing the level of indentation.
</p>

<p>
The old style of <code>let</code> is still useful, so I added  a similar construct called
<code>with</code>.
</p>
</div>
</div>

<div id="outline-container-orgab13a1a" class="outline-3">
<h3 id="orgab13a1a"><span class="section-number-3">2.2</span> Parameter/Argument Dichotomy</h3>
<div class="outline-text-3" id="text-2-2">
<p>
I decided to draw a distinction between parameters and arguments. Parameters are
the local variables that get bound when a function is called, whereas arguments
are the values which get passed into the function.
</p>

<p>
Here are a few facts that give a better idea of the relationship between
arguments and parameters:
</p>

<ul class="org-ul">
<li>Arguments provide values for parameters.</li>
<li>Parameters are specified at function creation. Arguments are specified during
function calls.</li>
<li>Parameters have names, arguments do not.</li>
<li>Variadic functions assign (lists or tables of) multiple arguments to single
variadic parameters.</li>
</ul>

<p>
This distinction is convenient because it allows us to talk unambiguously about
</p>
</div>
</div>

<div id="outline-container-org7da64c6" class="outline-3">
<h3 id="org7da64c6"><span class="section-number-3">2.3</span> Argument Lists/Keyword Syntax</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Fn function calls are similar to those in Python. Each parameter has a name, and
keyword syntax may be used to assign parameters by name. Trailing positional
parameters may be collected and bound to a variadic list parameter, and
unrecognized keyword parameters may be bound to a variadic table parameter.
</p>

<p>
I considered many, many approaches to this problem. Because function calling is
the most common operation in Fn, it is really important to get it right, and has
many consequences in how the rest of the language is designed and implemented.
</p>

<p>
Key decisions:
</p>
<dl class="org-dl">
<dt>Require that keyword parameters come after all positional parameters.</dt><dd>This
allows functions to simultaneously accept variadic keyword and variadic table
arguments without creating confusing behavior.</dd>
<dt>Do not provide pattern destructuring in parameter lists.</dt><dd>It is tempting to
incorporate pattern matching/destructuring in parameter lists. It can shorten
function bodies dramatically by allowing the pattern matching logic to do much
of the heavy lifting while actually making code easier to read. The main
problem is pattern matching parameters don't get along well with variadic
parameters, and seem to be fundamentally incompatible with optional parameters
(without introducing overcomplicated/ugly syntax). In the balance, optional
and variadic parameters seem more important, especially in the LISP family.
Moreover, Fn doesn't even have builtin pattern matching yet, which makes the
decision even easier.</dd>
<dt>Make keyword and positional parameters the same thing.</dt><dd>As opposed to the
calling style of Common Lisp. Really, I think that this Python-esque approach
is just a straight-up improvement for everything except macros (that's only a
maybe since I haven't written many yet).</dd>
</dl>
</div>
</div>

<div id="outline-container-org5fdb943" class="outline-3">
<h3 id="org5fdb943"><span class="section-number-3">2.4</span> Legal variables names and immutability of globals</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Since keywords have a special meaning as function arguments, I decided it was
important that a keyword by itself would never be a legal expression (since this
would create ambiguity). This is also why keywords aren't self-quoting.
</p>

<p>
Avoiding ambiguity is also the reason why special operators and constants are
banned as variable names.
</p>

<p>
At this point, you may wonder why we don't just categorically ban all stupid
variable names. The problem is that macros may generate local variables e.g. to
implement a DSL, and the current solution might necessitate some form of name
mangling. It is for this reason that I am even considering relaxing some of the
name restrictions on local variables.
</p>
</div>
</div>

<div id="outline-container-orge8a2771" class="outline-3">
<h3 id="orge8a2771"><span class="section-number-3">2.5</span> Parameters have default values instead of initforms</h3>
<div class="outline-text-3" id="text-2-5">
<p>
For most cases this is what you really want anyway, and you get the added
benefit of not having to evaluate a form to compute the value every time.
</p>

<p>
It's also easier to implement. If you really want initform functionality, then a
default value of <code>null</code> and an if statement should work for most cases.
</p>
</div>
</div>

<div id="outline-container-orgc039555" class="outline-3">
<h3 id="orgc039555"><span class="section-number-3">2.6</span> Arguments to <code>apply</code></h3>
<div class="outline-text-3" id="text-2-6">
<p>
Since Fn has a different calling convention than most dialects of Lisp, we need
a different <code>apply</code>. In particular, to allow passing of keyword arguments, the
last argument of now must be a table. The second to last is the usual list. This
order reflects the fact that keyword arguments come after positional ones.
</p>

<p>
I thought about making the list/table arguments come at the beginning, but this
approach feels more like classic lisp. (I also like having the regular
positional arguments directly follow the function).
</p>
</div>
</div>

<div id="outline-container-orgf092468" class="outline-3">
<h3 id="orgf092468"><span class="section-number-3">2.7</span> Namespace Search Paths</h3>
<div class="outline-text-3" id="text-2-7">
<p>
Namespace organization &amp; imports will likely have more design changes in the
future. The current approach should be suitable for 95% of use cases.
</p>

<p>
Our approach is to provide 3 default locations which are searched in this order:
</p>
<ul class="org-ul">
<li>interpreter working directory</li>
<li>user home namespace directory <code>$HOME/.local/lib/fn/ns</code></li>
<li>system namespace directory <code>$PREFIX/lib/fn/ns</code></li>
</ul>

<p>
The working directory and home namespace directory can be excluded from the
search path by using the respective command line options. Fn is intended to be
used as a system scripting language, and this allows us to safely make
executable one-file scripts using a shebang.
</p>
</div>
</div>

<div id="outline-container-org5c58bef" class="outline-3">
<h3 id="org5c58bef"><span class="section-number-3">2.8</span> Table Calls</h3>
<div class="outline-text-3" id="text-2-8">
<p>
Because they can represent partial computations, functions generally provide a
more flexible way to encapsulate information than tables or lists. Modern
functional programming styles exploit this flexibility, allowing complicated
logic and control flow operations to be expressed succinctly (see for instance
the Clojure idiom of transducers).
</p>

<p>
However, there are some major downsides to using functions. The most obvious is
their opacity. From looking at a function object, it is hard to tell how it will
behave, and there is no general way to modify the function other than by
wrapping it. As a result, code that relies heavily on function composition can
be very difficult to debug, and the many layers of wrapped functions can
</p>

<p>
Tables are the primary means of creating complex data structures in Fn.
</p>
</div>
</div>
</div>

<div id="outline-container-org31d20c1" class="outline-2">
<h2 id="org31d20c1"><span class="section-number-2">3</span> Implementation Decisions</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgdbebb8d" class="outline-3">
<h3 id="orgdbebb8d"><span class="section-number-3">3.1</span> Why add a <code>vm_handle</code> type?</h3>
</div>

<div id="outline-container-org9e6a1d3" class="outline-3">
<h3 id="org9e6a1d3"><span class="section-number-3">3.2</span> Why value is a union and only some things are methods</h3>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2021-05-30 Sun 23:21</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
